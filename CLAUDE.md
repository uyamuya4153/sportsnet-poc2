# 富山県公共施設予約システム 空き監視ツール

## 概要

富山県公共施設予約システム（https://k4.p-kashikan.jp/toyama-pref/）の空き状況を監視し、
指定した施設・日付・時間帯に空きが出た場合にスクリーンショットを保存するツールです。

## 技術スタック

- **言語**: TypeScript
- **ランタイム**: Node.js
- **ブラウザ自動操作**: Playwright
- **設定形式**: JSON

## ディレクトリ構成

```
sportsnet-poc2/
├── src/
│   ├── index.ts          # エントリーポイント
│   ├── scraper.ts        # サイト巡回ロジック
│   ├── checker.ts        # 空き状況判定ロジック
│   └── types.ts          # 型定義
├── config.json           # 監視設定
├── screenshots/          # スクリーンショット保存先
├── CLAUDE.md             # このファイル
├── TODO.md               # 作業進捗管理
├── package.json
└── tsconfig.json
```

## セットアップ

```bash
# 依存関係のインストール
npm install

# Playwrightのブラウザをインストール
npx playwright install chromium
```

## 使い方

### 1. 設定ファイルを編集

`config.json` を編集して、監視対象の施設・日付・時間帯を指定します。

```json
{
  "targets": [
    {
      "facility": "富山県総合体育センター",
      "room": "大アリーナ全面",
      "date": "2025-01-15",
      "timeSlots": ["9:00", "10:00", "13:00"]
    }
  ],
  "screenshotDir": "./screenshots"
}
```

### 2. 実行

```bash
# ビルドして実行
npm run start

# 開発モード（ts-nodeで直接実行）
npm run dev

# 別の設定ファイルを指定
npm run start -- ./my-config.json
```

## 設定項目

| 項目 | 説明 | 例 |
|------|------|-----|
| `facility` | 施設名（サイトに表示される名前と一致させる） | `"富山県総合体育センター"` |
| `room` | 部屋名（部分一致で検索） | `"大アリーナ全面"` |
| `date` | 監視対象の日付（YYYY-MM-DD形式） | `"2025-01-15"` |
| `timeSlots` | 監視対象の時間帯 | `["9:00", "10:00"]` |
| `screenshotDir` | スクリーンショット保存先 | `"./screenshots"` |

## 出力

- **コンソール**: チェック状況と結果をリアルタイムで表示
- **スクリーンショット**: 空きが見つかった場合、`screenshots/` ディレクトリに保存

## 終了コード

| コード | 意味 |
|--------|------|
| 0 | 空きが見つかった |
| 1 | 空きが見つからなかった |
| 2 | エラーが発生した |

## 対象サイトの構造

- SPAで構築されている
- 施設選択 → 日付選択 → 時間帯ごとの空き状況表示
- 空き状況の表示:
  - `●` = 空き
  - `×` = 予約済み
  - `-` = 受付期間外

## 注意事項

- サイトへの過度なアクセスを避けるため、連続実行時は適切な間隔を空けてください
- サイトの仕様変更により動作しなくなる可能性があります
